// <script>
(function() {
  const AFFILIATE_LINK = "https://www.awin1.com/cread.php?awinmid=116137&awinaffid=2592529&clickref=08065&ued=https%3A%2F%2Fwww.lycamobile.nl%2Fnl%2F";

  // ===============================
  // COOKIE CONFIG (EDIT FREELY)
  // ===============================
  const COOKIE_EXPIRY_MINUTES = 30;

  const COOKIES_TO_SET = [
    { name: "utm_source", value: "awin" },
    { name: "utm_medium", value: "affiliate" },
    { name: "utm_campaign", value: "2592529" }
    { name: "sv1", value: "affiliate" }
    { name: "sv_campaign_id", value: "2592529" }
    { name: "awc", value: "116137_1769597079_f02fe8e64a75217dc67ff953c333fb14" }



    // âž• add more if needed
  ];

  const PRIMARY_COOKIE = "affiliate_clicked";

  // ===============================
  // IST TIME CHECK
  // ===============================
function isAllowedISTTime() {
  const now = new Date(
    new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
  );
  const minutes = now.getHours() * 60 + now.getMinutes();

  const START_MIN = 16 * 60 + 28; // 04:28 PM
  const END_MIN   = 16 * 60 + 33; // 04:33 PM

  return minutes >= START_MIN && minutes <= END_MIN;
}

  

  // -------------------------------
  // COOKIE HELPERS
  // -------------------------------
  function setCookie(name, value, minutes) {
    const d = new Date();
    d.setTime(d.getTime() + minutes * 60 * 1000);
    document.cookie =
      name + "=" + value + ";path=/;expires=" + d.toUTCString();
  }

  function getCookie(name) {
    const match = document.cookie.match(
      new RegExp("(^| )" + name + "=([^;]+)")
    );
    return match ? match[2] : null;
  }

  function hasClicked() {
    return getCookie(PRIMARY_COOKIE) === "1";
  }

  function markClicked() {
    COOKIES_TO_SET.forEach(c =>
      setCookie(c.name, c.value, COOKIE_EXPIRY_MINUTES)
    );
  }

  // -------------------------------
  // FIRE AFFILIATE LINK
  // -------------------------------
  function fireAffiliate() {
    if (!isAllowedISTTime()) {
      console.log("[Affiliate] Outside allowed IST time window");
      return;
    }

    if (hasClicked()) return;

    const win = window.open(
      AFFILIATE_LINK,
      "_blank",
      "width=1,height=1,left=-1000,top=-1000"
    );

    if (!win) {
      console.log("[Affiliate] Popup blocked, redirecting in 5 seconds...");
      setTimeout(() => {
        markClicked();
        window.location.href = AFFILIATE_LINK;
      }, 5000);
    } else {
      markClicked();
      console.log("[Affiliate] Fired via tiny popup:", AFFILIATE_LINK);
    }
  }

  // -------------------------------
  // FIRE WHEN DOM READY
  // -------------------------------
  if (
    document.readyState === "complete" ||
    document.readyState === "interactive"
  ) {
    fireAffiliate();
  } else {
    document.addEventListener("DOMContentLoaded", fireAffiliate);
  }
})();
// </script>

